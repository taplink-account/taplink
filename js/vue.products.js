window.$app.defineComponent("products","vue-products-collections-form",{data:function(){return{isUpdating:!1,isFetching:!1,isFetchingProduct:!1,isReadonly:!1,autocompleteProducts:[],query:"",selected:[],values:{collection:"",is_hidden:!1,products:[]}}},created:function(){this.isReadonly=!this.$auth.isAllowEndpoint("products/collections/set"),this.collection_id&&this.fetchData(!0)},props:["collection_id"],mixins:[FormModel],methods:{fetchData:function(t){var e=this;this.isFetching=t,this.$api.get("products/collections/get",{collection_id:this.collection_id}).then(function(t){e.isFetching=!1,e.values=t.response.collection.values})},asyncAutocompleteProduct:_.debounce(function(){var e=this;""!=this.query.trim()?(this.isFetchingProduct=!0,this.$api.get("products/search",{query:this.query}).then(function(t){e.autocompleteProducts=t.response.products.search,e.isFetchingProduct=!1})):this.autocompleteProducts=[]},500),updateData:function(){var e=this;this.isUpdating=!0,this.onAddProduct();var t=_.clone(this.values);t.products=_.map(t.products,function(t){return t.product_id}),this.$api.post("products/collections/set",t,this).then(function(t){"success"==t.result&&e.$parent.close(),e.isUpdating=!1}).catch(function(t){e.isUpdating=!1})},deleteCollection:function(){var e=this;this.$confirm(this.$gettext("Вы уверены что хотите удалить эту коллекцию? Вы не сможете её вернуть!"),"is-danger").then(function(){e.$api.post("products/collections/delete",{collection_id:e.collection_id},e).then(function(t){"success"==t.result&&e.$parent.close()})})},onSelect:function(t){this.selected=t},onAddProduct:function(){this.selected&&!_.isEmpty(this.selected)&&-1==_.findIndex(this.values.products,{product_id:this.selected.product_id})&&(this.values.products.push(this.selected),this.query="")},onRemoveProduct:function(t){this.values.products.splice(t,1)}},template:'<div class="modal-card"> <header class="modal-card-head"> <p class="modal-card-title">{{\'Коллекция\'|gettext}}</p> <button class="modal-close is-large" @click="$parent.close()"></button> </header> <section class="modal-card-body modal-card-body-blocks"> <section> <b-field :label="\'Название\'|gettext" :message="errors.collection" :class="{\'has-error\': errors.collection}"> <b-input v-model="values.collection" :placeholder="\'Укажите название коллекции\'|gettext" :disabled="isReadonly"></b-input> </b-field> <div class="field"> <b-checkbox v-model="values.is_hidden" :disabled="isReadonly">{{\'Скрыть коллекцию из навигации в каталоге\'|gettext}}</b-checkbox> </div> </section> <section> <div class="row row-small has-mb-2"> <div class="col-xs"> <b-autocomplete v-model="query" :disabled="isReadonly" :data="autocompleteProducts" :placeholder="\'Укажите товар чтобы добавить его в коллекцию\'|gettext" field="product" :loading="isFetchingProduct" @input="asyncAutocompleteProduct" @select="onSelect"> </div> <div class="col-xs col-shrink"> <button type="button" class="button is-success" @click="onAddProduct" :disabled="isReadonly">{{\'Добавить\'|gettext}}</button> </div> </div> <mx-item class="is-hidden-mobile mx-item-header" v-if="values.products.length"> <div class="item-row row"> <div class="col-sm">{{\'Товар\'|gettext}}</div> </div> </mx-item> <sortable-list class="collection-products-list" lockAxis="y" v-model="values.products" use-drag-handle> <sortable-item v-for="(product, index) in values.products" class="form-fields-item is-narrow" :class="{disabled: isReadonly}" :index="index" :key="index" :item="product"> <div class="form-fields-item-title"> <div v-sortable-handle class="form-fields-item-handle"></div> <span class="row"> <div class="col-xs" :class="{\'has-text-grey-light\': !product.is_visible || !product.is_active}"><p class="form-control-static"><i class="has-text-danger fas fa-lock has-mr-1" v-if="!product.is_visible || !product.is_active" style="opacity:.5"></i>{{ product.product }}</p></div> <div class="col-xs col-shrink"><button class="button has-text-danger is-text" :class="{disabled: isReadonly}" @click="onRemoveProduct(index)"><i class="fa fa-trash-alt"></i></button></div> </span> </div> </sortable-item> </sortable-list> </section> </section> <footer class="modal-card-foot level"> <div class="level-left"> <button class="button level-item" @click="deleteCollection" v-if="!isReadonly && collection_id"><i class="fa fa-trash-alt"></i> {{\'Удалить\'|gettext}}</button> </div> <div class="level-right"> <button class="button is-dark" type="button" @click="$parent.close()">{{\'Отмена\'|gettext}}</button> <button class="button is-primary" :class="{\'is-loading\': isUpdating, disabled: isReadonly}" @click="updateData">{{\'Сохранить\'|gettext}}</button> </div> </footer> <b-loading :is-full-page="false" :active.sync="isFetching"></b-loading> </div>'}),window.$app.defineComponent("products","vue-products-collections-list",{data:function(){return{isFetching:!1,isFiltering:!1,isReadonly:!1,filter:{query:""},sortField:"collection",sortOrder:"asc",perPage:20,columns:["collection","amount"],isAllow:this.$auth.isAllowTariff("business")}},mixins:[ListModel],created:function(){this.isReadonly=!this.$auth.isAllowEndpoint("products/collections/set"),this.$io.on("events:products.collections.list:refresh",this.refreshCollections),this.$io.on("events:products.collections.list:delete",this.deleteCollection),this.fetchData(!0)},destroyed:function(){this.$io.off("events:products.collections.list:refresh",this.refreshCollections),this.$io.off("events:products.collections.list:delete",this.deleteCollection)},computed:{columns_props:function(){if(!this.columns)return[];for(var s={collection:{label:"Название",sortable:!0},amount:{label:"# Товаров",numeric:!0,sortable:!0,classname:"has-text-nowrap has-width-15"}},t=_.map(this.columns,function(t){var e=s[t];return e.visible=!0,e.field=t,e}),e=0;e<11-this.columns.length;e++)t.push({visible:!1});return t}},methods:{refreshCollections:function(t){var s=this;null!=t.product_ids?this.merge(this.fields,"collection_id",t.collection_ids,function(t,e){s.$api.get("products/collections/list",{filter:{collection_ids:t}}).then(function(t){s.fields=e(t.response.collections.fields)})}):this.fetchData(!1,!0)},deleteCollection:function(t){this.checkIds(this.fields,"collection_id",t.collection_ids).length&&(this.next=this.current,this.fetchData(!1,!0))},fetchData:function(t,e){var s=this;!e&&this.checkCache()||(this.isFetching=t,this.$api.get("products/collections/list",{next:this.next,count:this.perPage,sort_field:this.sortField,sort_order:this.sortOrder,filter:this.filter}).then(function(t){s.cachePage(t.response.collections),s.isFetching=!1,s.isFiltering=!1}).catch(function(t){throw s.accesses=[],s.total=0,s.isFetching=!1,s.isFiltering=!1,t}))},onPageChange:function(t){this.page=t,this.fetchData(!0)},onFilter:function(){this.isFiltering=!0,this.clearPages(),this.fetchData(!0)},openForm:function(t){this.$form("vue-products-collections-form",{collection_id:t},this)},clickRow:function(t){this.openForm(t.collection_id)}},template:'<div> <vue-component-filterbox ref="filterbox" v-if="isAllow" @filter="onFilter" v-model="filter" :is-visible="fields.length" :disabled="isFetching" :with-buttons="true"> <template slot="buttons"> <button class="button" @click="openForm(null)" class="button is-primary is-fullwidth" :class="{disabled: isReadonly}"><i class=\'fa fa-plus\'></i><span class=\'is-hidden-touch has-ml-1\'>{{\'Новая коллекция\'|gettext}}</span></button> </template> </vue-component-filterbox> <div class="container has-mb-3" :class="{\'has-mt-3\': !isAllow}"> <b-table paginated backend-pagination backend-sorting pagination-simple :data="fields" :loading="isFetching" :current-page="page" :per-page="perPage" :total="total" :default-sort="[sortField, sortOrder]" @page-change="onPageChange" @click="clickRow" @sort="onSort" hoverable bordered> <template slot-scope="props"> <b-table-column v-for="(column, index) in columns_props" :field="column.field" :label="column.label|gettext" :class="column.classname" :numeric="column.numeric" :key="index" :visible="column.visible" :sortable="column.sortable" :width="column.width"> <div :class="{\'has-text-grey-light\': props.row.is_hidden || !props.row.amount}"> <div v-if="column.field == \'collection\'"><div class="has-text-danger is-pulled-right" v-if="props.row.is_hidden"><i class="fas fa-lock" style="margin-left: 10px"></i></div> {{ props.row.collection }}</div> <div v-if="column.field == \'amount\'">{{ props.row.amount|number }}</div> </div> </b-table-column> </template> <template slot="empty"> <section class="has-mb-4 has-mt-4 content has-text-grey has-text-centered" v-if="!isFetching"> <div v-if="isAllow && $refs.filterbox.hasFilter || filter.query"> <i class="fal fa-search fa-5x has-text-grey-light"></i> <h3>{{\'Ничего не найдено\'|gettext}}</h3> </div> <div v-else> <div class="row"> <div class="col-xs-12 col-sm-8 col-sm-offset-2 col-md-6 col-md-offset-3"> <h3 class="has-p-2 has-text-grey-light has-text-centered has-mb-2"><i class="fal fa-tags has-text-grey-light" style="font-size: 5rem"></i></h3> <div class="has-mb-2">{{\'Коллекции служат для объединения товаров в группы. Одна коллекция может включать любые товары, а один и то же товар может входить в разные коллекции.\'|gettext}}</div> <button class="button" @click="openForm(null)" class="button is-primary" v-if="isAllow" :class="{disabled: isReadonly}"><i class=\'fa fa-plus\'></i>{{\'Новая коллекция\'|gettext}}</button> <div class="has-text-centered" v-else><div class="tag is-danger" style="top: -1px;position: relative;">biz</div> <span class=\'has-text-danger\'>{{\'Доступно на business-тарифе\'|gettext}}</span></div> </div> </div> </div> </section> <section class="has-mb-4 has-mt-4 content has-text-grey has-text-centered" v-if="isFetching"> <p>{{\'Загрузка данных\'|gettext}}</p> </section> </template> </b-table> </div> </div>'}),window.$app.defineComponent("products","vue-products-columns-form",{data:function(){return{isUpdating:!1,isFetching:!1,columns:[],sort:[],titles:[]}},created:function(){this.fetchData(!0)},mixins:[FormModel],methods:{fetchData:function(t){var e=this;this.isFetching=t,this.$api.get("products/columns/get").then(function(t){e.isFetching=!1,e.columns=t.response.products.columns,e.sort=t.response.products.sort,e.titles=t.response.products.titles})},updateData:function(){var e=this;this.isUpdating=!0,this.$api.post("products/columns/set",{columns:this.columns,sort:this.sort},this).then(function(t){"success"==t.result&&e.$parent.close(),e.isUpdating=!1}).catch(function(){e.isUpdating=!1})}},template:'<div class="modal-card"> <header class="modal-card-head"> <p class="modal-card-title">{{\'Настройки таблицы\'|gettext}}</p> <button class="modal-close is-large" @click="$parent.close()"></button> </header> <section class="modal-card-body"> <sortable-list class="form-fields-item-list" lockAxis="y" v-model="sort" use-drag-handle> <sortable-item v-for="(column, index) in sort" class="form-fields-item" :index="index" :key="index" :item="column"> <div class="form-fields-item-title"> <div v-sortable-handle class="form-fields-item-handle"></div> <span><label class="checkbox"><input type="checkbox" name=\'columns[]\' :value="column" v-model="columns"> {{ titles[column]|gettext }}</label></span> </div> </sortable-item> </sortable-list> </section> <footer class="modal-card-foot"> <button class="button is-dark" type="button" @click="$parent.close()">{{\'Отмена\'|gettext}}</button> <button class="button is-primary" :class="{\'is-loading\': isUpdating}" @click="updateData">{{\'Сохранить\'|gettext}}</button> </footer> <b-loading :is-full-page="false" :active.sync="isFetching"></b-loading> </div>'}),window.$app.defineComponent("products","vue-products-discounts-form",{data:function(){return{isUpdating:!1,isFetching:!1,isReadonly:!1,values:{discount_id:null,is_active:!0,title:"",promocode:"",options:{profit:"percentage",percentage:0,apply_options:!0,fixed:0,apply:"order",apply_collections:[],apply_products:[],rule:"none",rule_purchase:0,rule_quantity:0,rule_combo:[]}},variants:{profit:{percentage:"Процент",fixed:"Фиксированная сумма",free_shipping:"Бесплатная доставка"},apply:{order:"Всему заказу",collections:"Товарам из определенных коллекций",products:"Определенным товарам"},rule:{none:"Отсутствуют",purchase:"Минимальная сумма покупки",quantity:"Минимальное количество товаров"}},texts:{promocode:{title_new:"Новый промокод",title_old:"Промокод",active:"Активный промокод",deleteMsg:"Вы уверены что хотите удалить этот промокод? Вы не сможете его вернуть!"},automatic:{title_new:"Новая акция",title_old:"Акция",active:"Активная акция",deleteMsg:"Вы уверены что хотите удалить эту акцию? Вы не сможете его вернуть!"}}}},created:function(){this.isReadonly=!this.$auth.isAllowEndpoint("products/discounts/set"),this.discount_id&&this.fetchData(!0)},props:["type","discount_id"],mixins:[FormModel],methods:{onAction:function(t){switch(t){case"delete":this.onDelete()}},onDelete:function(){var e=this;this.$confirm(this.$gettext(this.texts[this.type].deleteMsg),"is-danger").then(function(){e.$api.get("products/discounts/delete",{discount_id:e.discount_id},e).then(function(t){"success"==t.result&&e.$parent.close()})})},promocodeFilter:function(t){var e=t.which?t.which:t.keyCode;String.fromCharCode(e).toUpperCase().match(/[A-ZА-Яa-zа-я0-9\-_]/)||t.preventDefault()},promocodeFilterAfter:function(){this.values.promocode=this.values.promocode.toUpperCase().replace(/[^A-ZА-Я0-9\-_ ]/g,"").trim().replace(/ /g,"_")},fetchData:function(t){var e=this;this.isFetching=t,this.$api.get("products/discounts/get",{discount_id:this.discount_id}).then(function(t){e.isFetching=!1,e.values=t.response.discounts.values})},updateData:function(){var e=this;this.isUpdating=!0,this.$api.post("products/discounts/set",Object.assign(this.values,{type:this.type}),this).then(function(t){"success"==t.result&&e.$parent.close(),e.isUpdating=!1}).catch(function(t){e.isUpdating=!1})}},template:'<div class="modal-card"> <header class="modal-card-head"> <p class="modal-card-title" v-if="values.discount_id">{{texts[type].title_old|gettext}}</p> <p class="modal-card-title" v-else>{{texts[type].title_new|gettext}}</p> <button class="modal-close is-large" @click="$parent.close()"></button> </header> <section class="modal-card-body modal-card-body-blocks"> <section> <b-field label="Промокод" :message="errors.promocode" maxlength="16" class="has-mb-1" :class="{\'has-error\': errors.promocode}" v-if="type == \'promocode\'"> <input class="input" v-model="values.promocode" @keypress="promocodeFilter" @change="promocodeFilterAfter" @keyup="promocodeFilterAfter" :disabled="isReadonly"></input> </b-field> <b-field label="Название акции" :message="errors.title" class="has-mb-1" :class="{\'has-error\': errors.title}" v-else> <b-input v-model="values.title" placeholder="Например: SALE" :disabled="isReadonly"></b-input> </b-field> <b-checkbox v-model="values.is_active" :disabled="isReadonly">{{texts[type].active|gettext}}</b-checkbox> </section> <section> <label class="label has-mb-2">{{\'Вид скидки\'|gettext}}</label> <div class="is-block has-mb-1" v-for="(v, k) in variants.profit"> <label class="radio is-flex"> <input type="radio" v-model="values.options.profit" :value="k" :disabled="isReadonly"/> <div class="is-flex-body"> <div class="is-flex-title">{{v|gettext}}</div> <div v-if="k != \'free_shipping\'"> <b-field :message="errors.profit_percentage" class="has-mt-1" :class="{\'has-error\': errors.profit_percentage}" v-if="k == \'percentage\' && values.options.profit == \'percentage\'"> <div class="row"> <div class="col-xs-12 col-sm-6 col-md-5 has-xs-mb-1"> <b-field> <p class="control is-expanded"><number v-model="values.options.percentage" class="input has-text-right" :disabled="isReadonly"/></p> <p class="control"><a class="button is-static">%</a></p> </b-field> </div> <div class="col-xs-12 col-sm-6 col-md-5" style="align-items: center;display: flex;"> <label class="checkbox"> <input type="checkbox" v-model="values.options.apply_options" :value="true" :disabled="isReadonly"/> Применять к опциям </label> </div> </div> </b-field> <b-field :message="errors.profit_fixed" class="has-mt-1" :class="{\'has-error\': errors.profit_fixed}" v-if="[\'percentage\', \'fixed\'].indexOf(values.options.profit) != -1" v-if="k == \'fixed\' && values.options.profit == \'fixed\'"> <div class="row"> <div class="col-xs-12 col-sm-6 col-md-5"> <b-field> <p class="control is-expanded"><number v-model="values.options.fixed" :precision="$account.currency.precision" class="input has-text-right" :disabled="isReadonly"/></p> <p class="control"><a class="button is-static">{{ $account.currency.title }}</a></p> </b-field> </div> </div> </b-field> </div> </div> </label> </div> </section> <section v-if="values.options.profit != \'free_shipping\'"> <label class="label has-mb-2">{{\'Применяется к\'|gettext}}</label> <div class="is-block has-mb-1" v-for="(v, k) in variants.apply"> <label class="radio is-flex"> <input type="radio" v-model="values.options.apply" :value="k" :disabled="isReadonly"/> <div class="is-flex-body"> <div class="is-flex-title">{{v|gettext}}</div> <b-field :message="errors.apply_collections" :class="[\'has-mt-1\', {\'has-error\': errors.apply_collections}]" v-if="k == \'collections\' && values.options.apply == \'collections\'"> <vue-component-autocomplete-collections v-model="values.options.apply_collections" :allowNew="false" :placeholder="\'Начните вводить название коллекции\'|gettext" :disabled="isReadonly"></vue-component-autocomplete-collections> </b-field> <b-field :message="errors.apply_products" :class="[\'has-mt-1\', {\'has-error\': errors.apply_products}]" v-if="k == \'products\' && values.options.apply == \'products\'"> <vue-component-autocomplete-products v-model="values.options.apply_products" :allowNew="false" :placeholder="\'Начните вводить название продуктов\'|gettext" :disabled="isReadonly"></vue-component-autocomplete-products> </b-field> </div> </label> </div> </section> <section v-if="type == \'automatic\'"> <label class="label has-mb-2">{{\'Минимальные требования\'|gettext}}</label> <div class="is-block has-mb-1" v-for="(v, k) in variants.rule"> <label class="radio is-flex"> <input type="radio" v-model="values.options.rule" :value="k" :disabled="isReadonly"/> <div class="is-flex-body"> <div class="is-flex-title">{{v|gettext}}</div> <div class="row has-mt-1" v-if="k == \'purchase\' && values.options.rule == \'purchase\'"> <div class="col-xs-12 col-sm-6 col-md-5"> <b-field :message="errors.rule_purchase" :class="{\'has-error\': errors.rule_purchase}"> <div> <b-field> <p class="control is-expanded"><number v-model="values.options.rule_purchase" :precision="$account.currency.precision" class="input has-text-right" :disabled="isReadonly"/></p> <p class="control"><a class="button is-static">{{ $account.currency.title }}</a></p> </b-field> </div> </b-field> </div> </div> <div class="row has-mt-1" v-if="k == \'quantity\' && values.options.rule == \'quantity\'"> <div class="col-xs-12 col-sm-6 col-md-5"> <b-field :message="errors.rule_quantity" :class="{\'has-error\': errors.rule_quantity}"> <input type="number" v-model="values.options.rule_quantity" class="input has-text-right" min="1" :disabled="isReadonly"> </b-field> </div> </div> <div v-if="k != \'none\' && k != \'combo\' && k== values.options.rule && values.options.apply != \'order\' && values.options.profit != \'free_shipping\'" class="has-mt-1 has-text-grey"> <p v-if="values.options.apply == \'collections\'">Относится только к выбранным коллекциям</p> <p v-if="values.options.apply == \'products\'">Относится только к выбранным товарам</p> </div> </div> </label> </div> </section> </section> <footer class="modal-card-foot level"> <div class="level-left"> <div v-if="!isReadonly && values.discount_id"> <vue-component-action-button @action="onAction" :title="\'Действие\'|gettext"> <template slot="actions"> <b-dropdown-item value="delete" class="has-text-danger" :class="{disabled: values.has_orders}"><i class="fa fa-trash-alt"></i> {{\'Удалить\'|gettext}}</b-dropdown-item> </template> </vue-component-action-button> </div> </div> <div class="level-right" v-if="isReadonly"> <button class="button is-dark" type="button" @click="$parent.close()">{{\'Закрыть\'|gettext}}</button> </div> <div class="level-right" v-else> <button class="button is-dark" type="button" @click="$parent.close()">{{\'Отмена\'|gettext}}</button> <button class="button is-primary" :class="{\'is-loading\': isUpdating}" @click="updateData">{{\'Сохранить\'|gettext}}</button> </div> </footer> <b-loading :is-full-page="false" :active.sync="isFetching"></b-loading> </div>'}),window.$app.defineComponent("products","vue-products-discounts-list",{data:function(){return{isFetching:!1,filter:{query:""},isReadonly:!1,sortField:"tms_created",sortOrder:"desc",perPage:20,texts:{promocode:{button:"Добавить промокод",icon:"fa-ticket",description:"С помощью промокодов можно предоставить скидку или активировать бесплатную доставку. Промокоды могут применяться как ко всему заказу, так и к определенным товарам или коллекциям"},automatic:{button:"Добавить акцию",icon:"fa-badge-percent",description:"Предложите своим клиентам скидки, которые автоматически применяются в их корзине. Акции могут действовать как для всего ассортимента, так и для определенных товаров или коллекций"}},isAllow:this.$auth.isAllowTariff("business")}},props:["type"],mixins:[ListModel],created:function(){this.isReadonly=!this.$auth.isAllowEndpoint("products/discounts/set"),this.$io.on("events:products.discounts.list:refresh",this.refreshDiscountss),this.fetchData(!0)},destroyed:function(){this.$io.off("events:products.discounts.list:refresh",this.refreshDiscountss)},watch:{type:function(){this.checkedRows=[],this.fields=[],this.sortField="tms_created",this.sortOrder="desc",this.clearPages(),this.fetchData(!0)}},methods:{refreshDiscountss:function(t){console.log(t),null!=t.type&&t.type!=this.type||this.fetchData(!1,!0)},onFilter:function(){this.isFiltering=!0,this.clearPages(),this.fetchData(!0)},openForm:function(t){this.$form("vue-products-discounts-form",{discount_id:t,type:this.type},this)},clickRow:function(t){this.openForm(t.discount_id)},fetchData:function(t,e){function s(t){o.fields=_.map(t.fields,function(t){var e=t.options,s="",i="",a="";switch(e.profit){case"free_shipping":s="Бесплатная доставка";break;case"percentage":s=o.$decimal(e.percentage)+"% скидки";break;case"fixed":s=o.$currency(e.fixed)+" скидки"}if("free_shipping"!=e.profit)switch(i=" на ",e.apply){case"order":i+="весь заказ";break;case"products":i+=o.$plural("товар|товара|товаров",e.apply_products.length);break;case"collections":i+=o.$plural("коллекцию|коллекции|коллекций",e.apply_products.length)}if("automatic"==o.type)switch(e.rule){case"purchase":a+=" при заказе на "+o.$currency(e.rule_purchase);break;case"quantity":a+=" при заказе на "+o.$plural("товар|товара|товаров",e.rule_quantity);break;case"combo":a+=" при наличии в заказе товаров из набора"}return t.description=s+i+a,t}),o.isFetching=!1}var o=this;!e&&this.checkCache(s)||(this.isFetching=t,this.$api.get("products/discounts/list",{next:this.next,type:this.type,count:this.perPage,sort_field:this.sortField,sort_order:this.sortOrder,filter:this.filter}).then(function(t){o.cachePage(t.response.discounts,s)}).catch(function(t){throw o.fields=[],o.total=0,o.isFetching=!1,t}))}},template:'<div> <vue-component-filterbox ref="filterbox" v-if="isAllow" @filter="onFilter" v-model="filter" :is-visible="fields.length" :disabled="isFetching" :with-buttons="true"> <template slot="buttons"> <button class="button" @click="openForm(null)" class="button is-primary is-fullwidth" :class="{disabled: isReadonly}"><i class=\'fa fa-plus\'></i><span class=\'is-hidden-touch has-ml-1\'>{{texts[type].button|gettext}}</span></button> </template> </vue-component-filterbox> <div class="container has-mb-3" :class="{\'has-mt-3\': !isAllow}"> <b-table paginated backend-pagination backend-sorting pagination-simple :data="fields" :loading="isFetching" :current-page="page" :per-page="perPage" :total="total" :default-sort="[sortField, sortOrder]" @page-change="onPageChange" @click="clickRow" @sort="onSort" hoverable bordered> <template slot-scope="props"> <b-table-column field="promocode" label="Промокод" sortable v-if="type == \'promocode\'"><div>{{ props.row.promocode }}<div class="has-text-grey">{{ props.row.description }}</div></div></b-table-column> <b-table-column field="title" label="Название" sortable v-else><div>{{ props.row.title }}<div class="has-text-grey">{{ props.row.description }}</div></div></b-table-column> <b-table-column field="amount_used" label="Использовали" class="has-text-nowrap has-width-10" numeric sortable><span v-if="props.row.amount_used">{{ $plural(\'раз|раза|раз\', props.row.amount_used) }}</span></b-table-column> <b-table-column field="is_active" class="has-text-nowrap has-width-10" label="Статус" sortable> <div class="tag has-tag-dot" :class="props.row.is_active?\'is-success\':\'is-danger\'">{{props.row.is_active?\'Активный\':\'Не активный\'|gettext}}</div> </b-table-column> <b-table-column field="tms_created" label="Дата добавления" class="has-text-nowrap has-width-10" sortable>{{ props.row.tms_created|datetime }}</b-table-column> </template> <template slot="empty"> <section class="has-mb-4 has-mt-4 content has-text-grey has-text-centered" v-if="!isFetching"> <div v-if="isAllow && $refs.filterbox.hasFilter || filter.query"> <i class="fal fa-search fa-5x has-text-grey-light"></i> <h3>{{\'Ничего не найдено\'|gettext}}</h3> </div> <div v-else> <div class="row"> <div class="col-xs-12 col-sm-8 col-sm-offset-2 col-md-6 col-md-offset-3"> <h3 class="has-p-2 has-text-grey-light has-text-centered has-mb-2"><i :class="[\'fal\', \'has-text-grey-light\', texts[type].icon]" style="font-size: 5rem"></i></h3> <div class="has-mb-2">{{texts[type].description|gettext}}</div> <button class="button" @click="openForm(null)" class="button is-primary" v-if="$auth.isAllowTariff(\'business\')" :class="{disabled: isReadonly}"><i class=\'fa fa-plus\'></i>{{texts[type].button|gettext}}</button> <div class="has-text-centered" v-else><div class="tag is-danger" style="top: -1px;position: relative;">biz</div> <span class=\'has-text-danger\'>{{\'Доступно на business-тарифе\'|gettext}}</span></div> </div> </div> </div> </section> <section class="has-mb-4 has-mt-4 content has-text-grey has-text-centered" v-if="isFetching"> <p>{{\'Загрузка данных\'|gettext}}</p> </section> </template> </b-table> </div> </div>'}),window.$app.defineComponent("products","vue-products-form",{data:function(){return{isUpdating:!1,isFetching:!1,isReadonly:!1,price:0,values:{title:"",price:0,price_compare:null,weight:0,is_visible:!0,is_shipping:!1,is_active:!0,has_orders:!1,variants_ids:[],offers:[],options:[],variants:[],pictures:[]},variants:{global_variants:[]},activeTab:"common",variantAction:null,picturesUpdating:0}},created:function(){var e=this;this.isReadonly=!this.$auth.isAllowEndpoint("products/set"),this.product_id?this.fetchData(!0):(this.isFetching=!0,this.$api.get("products/info").then(function(t){e.isFetching=!1,e.variants=t.response.product.info.variants}))},computed:{linkProduct:function(){return this.$account.link+"/o/"+this.values.product_id.toString(16)+"/"},amountVariantsValues:function(){return _.reduce(_.map(this.values.variants,function(t){return t.variant_values.length}),function(t,e){return t*e})}},props:["product_id"],mixins:[FormModel],methods:{onAction:function(t){switch(t){case"delete":this.onDelete();break;case"archive":this.onArchive()}},onArchive:function(){var e=this;this.$confirm(this.$gettext("Вы уверены что хотите отправить этот товар в архив?"),"is-warning").then(function(){e.$api.post("products/archive",{product_ids:[e.product_id]},e).then(function(t){"success"==t.result&&e.$parent.close()})})},onRestore:function(){var e=this;this.$api.get("products/restore",{product_ids:[this.product_id]},this).then(function(t){"success"==t.result&&e.$parent.close()})},onDelete:function(){var e=this;this.$confirm(this.$gettext("Вы уверены что хотите удалить этот товар? Вы не сможете его вернуть!"),"is-danger").then(function(){e.$api.get("products/delete",{product_ids:[e.product_id]},e).then(function(t){"success"==t.result&&e.$parent.close()})})},fetchData:function(t){var e=this;this.isFetching=t,this.$api.get(["products/get","products/info"],{product_id:this.product_id},this).then(function(t){e.isFetching=!1,e.values=t.response.product.values,e.variants=t.response.product.info.variants})},updateData:function(){var e=this;this.isUpdating=!0;var t=this.$clone(this.values);t.pictures=_.map(t.pictures,function(t){return t.picture_id}),t.collections=_.map(t.collections,"collection"),t.offers=_.map(t.offers,function(t){return t.variants=_.map(t.variants,"key"),t}),t.variants=_.map(t.variants,function(t){switch(t.variant_type){case"local":t.variant_values=_.map(t.variant_values,"value");break;case"global":t={variant_id:t.variant_id,variant_type:t.variant_type}}return t}),this.$api.post("products/set",t,this).then(function(t){"success"==t.result&&e.$parent.close(),e.isUpdating=!1}).catch(function(t){e.isUpdating=!1})},onVariantAction:function(){var t=this;null!=this.variantAction&&(null==this.values.variants&&(this.values.variants=[]),"add"==this.variantAction?this.values.variants.push({variant_id:null,variant_title:"",variant_values:[],variant_type:"local"}):this.values.variants.push(this.variants.global_variants[this.variantAction]),Vue.nextTick(function(){t.variantAction=null}),_.each(this.values.offers,function(t){t.variants.push({variant_id:null,key:""})}))},onRemoveOffer:function(t){var e=this;this.$confirm(this.$gettext("Вы уверены, что хотите удалить этот вариант?"),"is-danger").then(function(){e.values.offers.splice(t,1)})},onAddOffer:function(){var t=_.map(this.values.variants,function(t){return{variant_id:t.variant_id,key:""}});this.values.offers.push({offer_id:null,variants:t,price:null})},onAddAllOffers:function(){var i=this,t=_.map(this.values.variants,"variant_values"),s=_.reduce(t,function(t,s){return _.flatten(_.map(t,function(e){return _.map(s,function(t){return e.concat([t.key])})}))},[[]]);s.length>this.values.offers.length&&this.$confirm("Будет добавлено вариантов: "+(s.length-this.values.offers.length)+" шт. Добавить?","is-warning",{yes:"Да",no:"Нет"}).then(function(){var e=_.map(i.values.offers,function(t){return _.map(t.variants,function(t){return t.key}).join(":")});_.each(s,function(s){if(-1==e.indexOf(s.join(":"))){var t=_.map(i.values.variants,function(t,e){return{variant_id:t.variant_id,key:s[e]}});i.values.offers.push({offer_id:null,variants:t,price:null})}})})},onRemoveVariant:function(e){var t=this;this.$confirm("Вы уверены, что хотите удалить это свойство?","is-danger").then(function(){_.each(t.values.offers,function(t){t.variants.splice(e,1)}),t.values.variants.splice(e,1),0==t.values.variants.length&&(t.values.offers=[]);var s=[];t.values.offers=_.filter(t.values.offers,function(t){var e=_.map(t.variants,function(t){return t.key}).join(":");return-1==s.indexOf(e)&&(s.push(e),!0)})})},onAddValue:function(t,e){t.variant_values.pop();var s=_.maxBy(t.variant_values,"key");_.find(t.variant_values,["value",e])||t.variant_values.push({key:s?s.key+1:0,value:e})},onValuesRemove:function(e,t,s){function i(){_.each(a.values.offers,function(t){t.variants[s].key>=e.key&&""!==t.variants[s].key&&t.variants[s].key--}),_.each(t.variant_values,function(t){t.key>=e.key&&t.key--})}var a=this,o=_.sumBy(this.values.offers,function(t){return e.key===t.variants[s].key?1:0});o?(t.variant_values.splice(e.key,0,e),this.$confirm(this.$gettext("Вместе с удалением значения этой опции будут удалены добавленные варианты: %s шт.").replace("%s",o),"is-danger").then(function(){t.variant_values.splice(e.key,1),a.values.offers=_.filter(a.values.offers,function(t){return e.key!==t.variants[s].key}),i()})):i()},onRemoveOption:function(t){var e=this;this.$confirm(this.$gettext("Вы уверены, что хотите удалить эту опцию?"),"is-danger").then(function(){e.values.options.splice(t,1)})},onAddOption:function(){this.values.options.push({option_id:null,title:"",price:0})},onPicturesUploading:function(t){this.picturesUpdating=t}},template:'<div class="modal-card modal-card-large"> <header class="modal-card-head"> <p class="modal-card-title">{{\'Товар\'|gettext}}</p> <button class="modal-close is-large" @click="$parent.close()"></button> </header> <ul class="nav nav-tabs has-text-left"> <li :class="{active: activeTab== \'common\'}"><a href="#" @click="activeTab = \'common\'"><span class="is-hidden-mobile">{{\'Общая информация\'|gettext}}</span><span class="is-visible-inline-mobile">{{\'Общие\'|gettext}}</span></a></li> <li :class="{active: activeTab== \'offers\'}"><a href="#" @click="activeTab = \'offers\'">{{\'Варианты\'|gettext}}</a></li> <li :class="{active: activeTab== \'options\'}"><a href="#" @click="activeTab = \'options\'">{{\'Опции\'|gettext}}</a></li> <li :class="{active: activeTab== \'link\'}" v-if="values.product_id"><a href="#" @click="activeTab = \'link\'">{{\'Ссылка\'|gettext}}</a></li> </ul> <section class="modal-card-body modal-card-body-blocks" v-show="activeTab == \'common\'"> <section> <b-field :label="\'Название товара\'|gettext" :message="errors.title" :class="{\'has-error\': errors.title}"> <b-input v-model="values.title" :disabled="isReadonly" maxlength="255" :has-counter="false"></b-input> </b-field> <b-field :label="\'Описание товара\'|gettext" :message="errors.description" :class="{\'has-error\': errors.description}"> <vue-component-emoji-picker v-model="values.description"> <b-input v-model="values.description" :disabled="isReadonly" type="textarea" maxlength="65535" :has-counter="false"></b-input> </vue-component-emoji-picker> </b-field> <div class="row"> <div class="col-sm-3 col-xs-6 has-mb-2"> <b-field :label="\'Цена\'|gettext" :message="errors.price" :class="{\'has-error\': errors.price}"> <b-field> <p class="control is-expanded"><number v-model="values.price" :precision="$account.currency.precision" :disabled="isReadonly" class="input has-text-right"/></p> <p class="control"> <a class="button is-static">{{ $account.currency.title }}</a> </p> </b-field> </b-field> </div> <div class="col-sm-3 col-xs-6 has-mb-2"> <b-field :label="\'Старая цена\'|gettext" :message="errors.price_compare" :class="{\'has-error\': errors.price_compare}"> <b-field> <p class="control is-expanded"><number v-model="values.price_compare" :precision="$account.currency.precision" :disabled="isReadonly" class="input has-text-right"/></p> <p class="control"> <a class="button is-static">{{ $account.currency.title }}</a> </p> </b-field> </b-field> </div> <div class="col-sm-6 col-xs-12 has-mb-2"> <b-field :label="\'Коллекции\'|gettext" :message="errors.collections" :class="{\'has-error\': errors.collections}"> <vue-component-autocomplete-collections v-model="values.collections" :disabled="isReadonly" :placeholder="\'Начните вводить название коллекции\'|gettext"></vue-component-autocomplete-collections> </b-field> </div> </div> </section> <section> <div class="row"> <div class="col-sm-6 col-xs-12"> <div class="row"> <div class="col-sm-6 col-xs-12"> <b-field :label="\'Вес товара для доставки\'|gettext" :message="errors.weight" class="has-mb-2" :class="{\'has-error\': errors.weight}" expanded> <b-field expanded> <p class="control"><number v-model="values.weight" :precision="$account.weight.precision" :disabled="isReadonly" class="input has-text-right" expanded/></p> <p class="control"> <a class="button is-static">{{$account.weight.unit_title}}</a> </p> </b-field> </b-field> <div class="has-text-grey is-visible-mobile has-mb-2">{{\'Укажите вес товара, если это влияет на стоимость доставки\'|gettext}}</div> </div> <div class="col-sm-6 col-xs-12"> <div class="label is-hidden-mobile">&nbsp;</div> <b-checkbox v-model="values.is_shipping" :disabled="isReadonly">{{\'Требуется доставка\'|gettext}}</b-checkbox> </div> </div> <div class="has-text-grey is-hidden-mobile">{{\'Укажите вес товара, если это влияет на стоимость доставки\'|gettext}}</div> </div> <div class="col-sm-6 col-xs-12"> <div class="label is-hidden-mobile">&nbsp;</div> <b-checkbox v-model="values.is_visible" :disabled="isReadonly">{{\'Товар отображается в каталоге\'|gettext}}</b-checkbox> </div> </div> </section> <section> <b-field :label="\'Фотографии товара\'|gettext"> <vue-component-pictures v-model="values.pictures" :disabled="isReadonly" @startUploading="onPicturesUploading" @stopUploading="onPicturesUploading" multiple></vue-component-pictures> </b-field> </section> </section> <section class="modal-card-body modal-card-body-blocks" v-show="activeTab == \'offers\'"> <section> <div class="has-mb-2"> <p>{{\'Добавьте варианты, если этот товар поставляется в нескольких версиях, таких как разные размеры или цвета.\'|gettext}}</p> </div> <div class="row"> <div class="col-xs-12 col-sm-4"> <b-select @input="onVariantAction()" v-model="variantAction" :placeholder="\'-- Действие --\'|gettext" :disabled="values.variants.length>= 3 || isReadonly"> <optgroup :label="\'Действие\'|gettext"> <option value="add">{{\'Добавить новое свойство\'|gettext}}</option> </optgroup> <optgroup label="Глобальные свойства" v-if="variants.global_variants.length"> <option :value="i" :disabled="_.find(values.variants, [\'variant_id\', g.variant_id])" v-for="(g, i) in variants.global_variants">{{ g.variant_title }}</option> </optgroup> </b-select> </div> </div> </section> <section v-if="values.variants.length"> <div class="is-hidden-mobile"> <div class="row row-small"> <div class="col-xs-12 col-sm-3"> <label class="label has-mb-2">{{\'Название свойства\'|gettext}}</label> </div> <div class="col-xs-12 col-sm-9"> <label class="label has-mb-2">{{\'Значения свойства\'|gettext}}</label> </div> </div> </div> <div class="row row-small has-mb-2" :class="{disabled: isReadonly}" v-for="(v, index) in values.variants"> <div class="col-xs-12 col-sm-3"> <input type="text" v-model="v.variant_title" class="input block-xs" :placeholder="\'Укажите название опции\'|gettext" :disabled="isReadonly || (v.variant_type == \'global\')"> </div> <div class="col-xs-10 col-sm"> <b-taginput v-model="v.variant_values" field="value" @add="onAddValue(v, $event)" @remove="onValuesRemove($event, v, index)" confirm-key-codes=\'[13]\' :placeholder="\'Укажите значения через запятую\'|gettext" :disabled="isReadonly || (v.variant_type == \'global\')" attached> </div> <div class="col-xs col-sm-shrink text-xs-right"> <button type="button" class="button is-danger" :disabled="isReadonly" @click="onRemoveVariant(index)"><i class="fa fa-trash-alt"></i></button> </div> </div> </section> <section v-if="values.variants.length"> <div class="has-mb-2"> <mx-item class="is-hidden-mobile mx-item-header"> <div class="item-row row"> <div class="col-sm" v-for="v in values.variants">{{v.variant_title}}</div> <div class="col-sm has-text-right">{{\'Цена\'|gettext}}</div> <div class="col-xs-2 col-sm col-sm-shrink has-text-centered"> <div style="visibility: hidden;height:1px"> <a href="#" class="button has-text-danger"><i class="fa fa-trash-alt"></i></a> </div> </div> </div> </mx-item> <mx-item v-if="values.offers.length == 0"> <div class="item-row row"> <div class="col-xs has-text-centered has-text-grey-light">{{\'Варианты пока не добавлены\'|gettext}}</div> </div> </mx-item> <mx-item v-for="(o, index) in values.offers"> <div class="item-row row"> <div class="col-sm has-xs-mb-2" v-for="(v, index) in o.variants"> <b-select v-model="v.key" :disabled="isReadonly" expanded> <option value="">{{\'-- Не выбрано --\'|gettext}}</option> <option v-for="w in values.variants[index].variant_values" :value="w.key">{{w.value}}</option> </b-select> </div> <div class="col-sm col-xs-10 has-xs-mb-2"> <div class="field has-addons"> <div class="control is-expanded"><number type="text" class="input has-text-right" :precision="$account.currency.precision" :placeholder=\'values.price|currency\' v-model="o.price" :disabled="isReadonly"/></div> <div class="control"><span class="button is-static">{{ $account.currency.title }}</span></div> </div> </div> <div class="col-xs-2 col-sm col-sm-shrink has-text-right"> <button type="button" class="button has-text-danger" :disabled="isReadonly" :class="{disabled: isReadonly}" @click="onRemoveOffer(index)"><i class="fa fa-trash-alt"></i></button> </div> </div> </mx-item> </div> <div class="level"> <div class="level-left has-text-grey"> Всего вариантов: {{values.offers.length|number}} </div> <div class="level-right"> <a @click="onAddOffer()" v-if="!isReadonly">{{\'Добавить вариант\'|gettext}}</a><span class="has-text-grey" style="padding:0 .7rem"> &bull;</span> <a @click="onAddAllOffers()" v-if="!isReadonly" :class="{disabled: amountVariantsValues== values.offers.length}">{{\'Добавить все варианты\'|gettext}}</a> </div> </div> </section> </section> <section class="modal-card-body modal-card-body-blocks" v-show="activeTab == \'options\'"> <section> <div class="has-mb-2"> <p>{{\'Вы можете добавить дополнительные опции к вашему товару\'|gettext}}</p> </div> <div class="has-mb-2" id=\'productsOptionsBody\' v-if="values.options.length"> <mx-item class="is-hidden-mobile mx-item-header"> <div class="item-row row"> <div class="col-xs-7">{{\'Опция\'|gettext}}</div> <div class="col-xs col-price">{{\'Цена\'|gettext}}</div> <div class="col-xs col-shrink has-text-centered"> <a href=\'#\' class="button has-text-danger" style="visibility: hidden;height:1px"><i class="fa fa-trash-alt"></i></a> </div> </div> </mx-item> <mx-item v-for="(o, index) in values.options"> <div class="item-row row"> <div class="col-sm-7 col-xs-12 block-xs"><input type="text" class="input" :placeholder="\'Укажите название опции\'|gettext" v-model="o.title" :disabled="isReadonly"></div> <div class="col-sm col-xs-10 col-price"> <div class="field has-addons"> <div class="control is-expanded"><number type="text" class="input has-text-right" :precision="$account.currency.precision" v-model="o.price" :disabled="isReadonly"/></div> <div class="control"><span class="button is-static">{{ $account.currency.title }}</span></div> </div> </div> <div class="col-xs-2 col-sm col-sm-shrink has-text-centered"> <button type="button" class="button has-text-danger" @click="onRemoveOption(index)" :disabled="isReadonly" :class="{disabled: isReadonly}"><i class="fa fa-trash-alt"></i></button> </div> </div> </mx-item> </div> <a href=\'#\' @click="onAddOption()" v-if="!isReadonly">{{\'Добавить опцию\'|gettext}}</a> </section> </section> <section class="modal-card-body modal-card-body-blocks" v-if="values.product_id" v-show="activeTab == \'link\'"> <section> <div class="field has-addons"> <div class="control is-expanded"><input type="text" class="input" readonly="on" id="productLink" :value="linkProduct"></div> <div class="control"> <a class="button is-default" target="_blank" :href="linkProduct"><i class="fa fa-external-link"></i> Открыть</a> </div> </div> </section> </section> <footer class="modal-card-foot level"> <div class="level-left"> <div v-if="!isReadonly && values.product_id"> <vue-component-action-button @action="onAction" v-if="values.is_active" :title="\'Действие\'|gettext"> <template slot="actions"> <b-dropdown-item value="archive"><i class="fa fa-archive"></i> {{\'В архив\'|gettext}}</b-dropdown-item> <hr class="dropdown-divider" aria-role="menuitem"> <b-dropdown-item value="delete" class="has-text-danger" :class="{disabled: values.has_orders}"><i class="fa fa-trash-alt"></i> {{\'Удалить\'|gettext}}</b-dropdown-item> </template> </vue-component-action-button> <button v-if="!values.is_active" @click="onRestore" type="button" class="button is-success" name="action" value="restore"><i class="fa fa-undo"></i> {{\'Восстановить\'|gettext}}</button> </div> </div> <div class="level-right" v-if="isReadonly"> <button class="button is-dark" type="button" @click="$parent.close()">{{\'Закрыть\'|gettext}}</button> </div> <div class="level-right" v-else> <button class="button is-dark" type="button" @click="$parent.close()">{{\'Отмена\'|gettext}}</button> <button class="button is-primary" :class="{\'is-loading\': isUpdating}" @click="updateData" :disabled="picturesUpdating> 0">{{\'Сохранить\'|gettext}}</button> </div> </footer> <b-loading :is-full-page="false" :active.sync="isFetching"></b-loading> </div>'}),window.$app.defineComponent("products","vue-products-import-form",{data:function(){return{grid:null,data:null,isUpdating:!1,isFetching:!0,selects:[],columnSelect:null,values:{},is_done:!1,amount_inserted:0,amount_products:0}},mounted:function(){var n=this;this.$api.get("products/import/info").then(function(t){n.columns=t.response.products.import.columns,$mx.lazy("grid.js","grid.css",function(){var s={cols:3,rows:5,name:"data",clearPaste:"yes",autofocus:"yes"},e=$mx(n.$refs.grid),a=null,t=[],o=[];if(n.data&&null!=n.data.cells&&n.data.cells.length)o=s.data.cells,s.cols=Object.keys(o[0]).length;else for(i=1;i<=s.rows;i++)o.push({});for(i=1;i<=s.cols;i++)t.push({name:n.intToLetters(i),type:"string"});n.grid=e.grid(o,t),n.grid.registerEditor(BasicEditor),n.grid.render(),n.columns&&(n.columnSelect='<div class="select is-fullwidth"><select>'+_.map(n.columns,function(t){return'<option value="'+t.key+'">'+t.title+"</option>"})+"</select></div>",$mx("thead th div",e).html(n.columnSelect)),$mx.isset(s.data)&&$mx.isset(s.data.selects)&&s.data.selects.length&&$mx("thead th select",e).each(function(t,e){$mx(this).val(s.data.selects[t])}),s.name&&(a=$mx('<input type="hidden" name="'+s.name+'">').appendTo(e)),n.grid.events.on("editor:save",function(t){a&&(n.data={cells:n.grid.getGridData(),selects:$mx.makeArray($mx("select",e).map(function(){return this.value}))})}),n.grid.$el.on("change","select",function(){n.grid.events.trigger("editor:save")}),n.grid.events.trigger("editor:save");var l=$mx("tbody tr:first td:first",n.grid.$el);n.grid.setActiveCell(l),n.grid.$el.focus(),$mx(document).on("paste",n.paste),n.isFetching=!1})})},destroyed:function(){$mx(document).off("paste",this.paste),this.grid.destroy()},mixins:[FormModel],methods:{updateData:function(){var e=this;this.isUpdating=!0,this.$api.post("products/import/set",{data:this.data},this).then(function(t){"success"==t.result&&(e.amount_inserted=t.response.amount_inserted,e.amount_products=t.response.amount_products,e.is_done=t.response.is_done),e.isUpdating=!1}).catch(function(t){e.isUpdating=!1})},intToLetters:function(t){for(result="";0<=--t;)result=String.fromCharCode("A".charCodeAt(0)+t%26)+result,t/=26;return result},paste:function(n){if(this.grid.is(":focus")){var t=this.$refs.grid,e=null;$mx("tbody tr td:not(:first), thead tr th:not(:first)",t).remove(),$mx("tbody tr:not(:first)",t).remove(),this.grid.setActiveCell(e=$mx("tbody tr:first td:first",t));var s=e.index(),a=function(){for(var t=window.clipboardData?window.clipboardData:n.clipboardData,e=[],s=0;s<t.types.length;s++)e.push(t.types[s]);if(-1!=e.indexOf("text/html")&&(a=$mx(n.clipboardData.getData("text/html"))).is("table"))return $mx("tr",a).map(function(){return $mx("td",this).map(function(){return this.innerText.trim()})});if(-1==e.indexOf("text/plain"))return[];var a,o=(a=n.clipboardData.getData("text/plain")).trim().split(/\r\n|\n|\r/),l=[];for(i=0;i<o.length;i++)l.push(o[i].split("\t"));return l}();for(i=0;i<a.length;i++){var o=a[i];if(o.length){for(j=0;j<o.length;j++)if($mx("div",e).text(o[j]),j<o.length-1){if(next=e.next(),0==next.length){var l=e.closest("tr"),c=l.index(),r=l.closest("table"),d=$mx("thead tr",r),u=this.intToLetters($mx("th",d).length+1),p=0;$mx("tbody tr",r).each(function(){var t=$mx("<td><div></div></td>").data(e.data()).data("column",u).appendTo(this);p==c&&(next=t),p++}),$mx("<th><div>"+(null!=this.columnSelect?this.columnSelect:u)+"</div></th>").appendTo(d)}e=next}if(i<a.length-1){if(l=e.closest("tr"),next=l.next(),0==next.length){next=$mx(l[0].outerHTML),next.find("div").empty(),tdnext=$mx("td",next);p=0;$mx("td",l).each(function(){var t=$mx(this);$mx(tdnext[p]).data(t.data()),p++}),next.appendTo(l.parent()).removeClass("activeRow"),tdnext.removeClass("activeCell").find("div").empty()}e=$mx(next.find("td")[s])}}}n.preventDefault(),this.grid.events.trigger("editor:save")}}},template:'<div class="modal-card modal-card-large"> <header class="modal-card-head"> <p class="modal-card-title">{{\'Загрузка товаров из Excel\'|gettext}}</p> <button class="modal-close is-large" @click="$parent.close()"></button> </header> <section class="modal-card-body"> <div class="message is-success" v-if="is_done"><div class="message-body">Добавленно товаров: {{amount_inserted|number}} из {{amount_products|number}}</div></div> <div v-else> <div ref="grid" class="has-mb-4" style="position:relative"></div> <div class="block-arrow-left-top" style="margin-top: -15px;opacity:0.5"> Скопируйте нужные ячейки из Excel и вставьте в эту таблицу </div> </div> </section> <footer class="modal-card-foot"> <button class="button is-dark" type="button" @click="$parent.close()">{{\'Закрыть\'|gettext}}</button> <button v-if="!is_done" class="button is-primary" :class="{\'is-loading\': isUpdating}" @click="updateData">{{\'Загрузить\'|gettext}}</button> </footer> <b-loading :is-full-page="false" :active.sync="isFetching"></b-loading> </div>'}),window.$app.defineComponent("products","vue-products-list",{data:function(){return{isSortable:!1,isReadonly:!1,isFiltering:!1,isFetching:!1,columns:!1,filter:{query:"",price:{from:"",until:""},collections:[]},sortField:"ordernum",sortOrder:"desc",tmpSort:{field:"",order:""},isAllow:this.$auth.isAllowTariff("business")}},mixins:[ListModel,SortableTable],props:["type"],computed:{columns_props:function(){if(!this.columns)return[];for(var s={title:{label:"Название",sortable:!0},status:{label:"Статус",classname:"has-width-10"},price:{label:"Цена",numeric:!0,sortable:!0,classname:"has-text-nowrap has-width-10"},weight:{label:"Вес",numeric:!0,sortable:!0,classname:"has-text-nowrap has-width-10"},tms_created:{label:"Дата добавления",sortable:!0,classname:"has-text-nowrap has-width-10"},collections:{label:"Коллекции",classname:"has-text-nowrap"}},t=_.map(this.columns,function(t){var e=s[t];return e.visible=!0,e.field=t,e}),e=0;e<11-this.columns.length;e++)t.push({visible:!1});return t[0].numeric=!1,t},currency_title:function(){return this.$account.currency.title},linkShop:function(){return this.$account.link+"/m/"}},watch:{type:function(){this.checkedRows=[],this.clearPages(),this.fetchData(!0)},isSortable:function(t){t?window.addEventListener("scroll",this.resortEventScroll):window.removeEventListener("scroll",this.resortEventScroll)}},created:function(){this.isReadonly=!this.$auth.isAllowEndpoint("products/set"),this.$io.on("events:products.list:refresh",this.refreshProducts),this.$io.on("events:products.list:delete",this.deleteProduct),this.$io.on("events:products.list:columns",this.refreshColumns),this.fetchData(!0)},beforeDestroy:function(){this.isSortable&&window.removeEventListener("scroll",this.resortEventScroll),this.$io.off("events:products.list:refresh",this.refreshProducts),this.$io.off("events:products.list:delete",this.deleteProduct),this.$io.off("events:products.list:columns",this.refreshColumns)},methods:{resortEventScroll:function(){this.bottomVisible()&&!this.isFetching&&this.next&&(this.page++,this.fetchData(!0))},bottomVisible:function(){var t=window.scrollY,e=document.documentElement.clientHeight;return document.documentElement.scrollHeight<e+t+200&&t},onDropdown:function(t){switch(t){case"view":window.open(this.linkShop);break;case"import":this.$form("vue-products-import-form");break;case"columns":this.$form("vue-products-columns-form");break;case"resort":this.isSortable=!0,this.tmpSort={field:this.sortField,order:this.sortOrder},this.onSort("ordernum","desc"),this.fields=[]}},stopResort:function(){this.onSort(this.tmpSort.field,this.tmpSort.order),this.isSortable=!1},onAction:function(t){var e=this,s=null;switch(t){case"delete":s=this.$gettext("Вы уверены что хотите удалить эти товары?")}function i(){e.$api.post("products/"+t,{product_ids:e.checkedRows},e).then(function(t){"success"==t.result&&(e.checkedRows=[])})}s?this.$confirm(this.$gettext(s),"is-danger").then(i):i()},refreshProducts:function(t){var s=this;null!=t.product_ids?this.merge(this.fields,"product_id",t.product_ids,function(t,e){s.$api.get("products/list",{filter:{product_ids:t}}).then(function(t){s.fields=e(t.response.products.fields)})}):(this.clearPages(),this.fetchData(!1,!1))},deleteProduct:function(t){console.log(t),console.log(this.fields);var e=this.checkIds(this.fields,"product_id",t.product_ids);console.log(e),e.length&&(this.next=this.current,this.fetchData(!1,!0))},refreshColumns:function(t){var e=_.difference(t,this.columns).length;this.columns=t,e&&this.fetchData(!1,!0)},fetchData:function(t,e){function s(t){i.isSortable?i.fields=i.fields.concat(t.fields):i.fields=t.fields,i.columns||(i.columns=t.columns)}var i=this;!e&&this.checkCache(s)||(this.isFetching=t,this.$api.post(this.columns?"products/list":["products/list","products/columns/get"],{next:this.next,count:this.perPage,columns:this.columns,sort_field:this.sortField,sort_order:this.sortOrder,filter:this.isSortable?[]:this.filter,type:this.type}).then(function(t){i.cachePage(t.response.products,s),i.isFetching=!1,i.isFiltering=!1}).catch(function(t){throw i.accesses=[],i.total=0,i.isFetching=!1,i.isFiltering=!1,t}))},onFilter:function(){this.isFiltering=!0,this.clearPages(),this.fetchData(!0)},clickRow:function(t){this.$form("vue-products-form",{product_id:t.product_id},this)},onReSort:function(t,e,s,i){var a=this;this.isFetching=!0,this.$api.get("products/resort",{product_id:s.product_id,index_product_id:i.product_id},this).then(function(t){a.isFetching=!1})}},template:'<div> <vue-component-filterbox ref="filterbox" v-if="isAllow" :showToolbar="isSortable" @dropdown="onDropdown" :is-visible="fields.length" @action="onAction" @filter="onFilter" :disabled="isFetching" :selected="checkedRows" v-model="filter" :with-dropdown="true" :with-filters="true" :with-buttons="true"> <template slot="toolbar"> <a @click="stopResort" class="button is-dark"><i class="fal fa-check has-mr-2"></i> Завершить сортировку</a> </template> <template slot="buttons"> <a @click="clickRow({product_id: null})" class="button is-primary is-fullwidth" :class="{disabled: isReadonly}"><i class=\'fas fa-plus\'></i><span class=\'is-hidden-touch has-ml-1\'>{{\'Новый товар\'|gettext}} </span></a> </template> <template slot="dropdown"> <b-dropdown-item value="view"><i class="fal fa-shopping-bag has-text-centered has-mr-1"></i> {{\'Открыть магазин\'|gettext}}</b-dropdown-item> <hr class="dropdown-divider"> <b-dropdown-item value="columns"><i class="fas fa-bars fa-rotate-90 has-text-centered has-mr-1"></i> {{\'Настроить колонки таблицы\'|gettext}}</b-dropdown-item> <b-dropdown-item value="resort" class="is-hidden-touch"><i class="fal fa-arrows has-text-centered has-mr-1"></i> Настроить порядок товаров</b-dropdown-item> <b-dropdown-item value="import"><i class="fal fa-cloud-upload has-text-centered has-mr-1"></i> {{\'Загрузить товары\'|gettext}}</b-dropdown-item> </template> <template slot="actions"> <b-dropdown-item value="archive" v-if="type == \'active\'"><i class="fa fa-archive has-text-centered has-mr-1"></i> {{\'В архив\'|gettext}}</b-dropdown-item> <b-dropdown-item value="restore" v-if="type == \'archive\'"><i class="fa fa-undo has-text-centered has-mr-1"></i> {{\'Восстановить\'|gettext}}</b-dropdown-item> <hr class="dropdown-divider" v-if="type == \'active\'"> <b-dropdown-item value="delete" v-if="type == \'active\'" class="has-text-danger"><i class="fa fa-trash-alt has-text-centered has-mr-1"></i> {{\'Удалить\'|gettext}}</b-dropdown-item> </template> <template slot="filters"> <div class="row"> <div class="col-xs-12 col-sm-4 has-mb-2"> <label class="label">{{\'Коллекции\'|gettext}}</label> <vue-component-autocomplete-collections v-model="filter.collections" :allow-new="false" :placeholder="\'Начните вводить название коллекции\'|gettext"></vue-component-autocomplete-collections> </div> <div class="col-xs-12 col-sm-4 has-mb-2"> <label class="label">{{\'Цена\'|gettext}}</label> <div class="row row-small"> <div class="col-xs"><number v-model="filter.price.from" :precision="$account.currency.precision" class="input" :placeholder="\'От\'|gettext"></number></div> <div class="col-xs col-shrink has-text-grey" style="line-height: 2.45em">-</div> <div class="col-xs"><number v-model="filter.price.until" :precision="$account.currency.precision" class="input" :placeholder="\'До\'|gettext"></number></div> </div> </div> </div> </template> </vue-component-filterbox> <div class="container has-mb-3" :class="{\'has-mt-3\': !isAllow}"> <b-table :paginated="!isSortable" backend-pagination backend-sorting pagination-simple :data="fields" :loading="isFetching" :current-page="page" :per-page="perPage" :total="total" :default-sort="[sortField, sortOrder]" @page-change="onPageChange" @click="clickRow" @sort="onSort" :draggable="isSortable" @dragstart="rowDragStart" :class="{\'is-sortable\': isSortable}" @drop="rowDrop" @dragover="rowDragOver" @dragleave="rowDragLeave" :hoverable="!isSortable" bordered> <template slot-scope="props" slot="header"> <b-checkbox @click.native.stop="onCheckAll($event, checkedRows)" v-if="!props.index && fields.length"></b-checkbox> {{ props.column.label }} </template> <template slot-scope="props"> <b-table-column v-for="(column, index) in columns_props" :field="column.field" :label="column.label|gettext" :class="[column.classname, {\'has-text-grey-light\': !props.row.is_visible}]" :numeric="column.numeric" :key="index" :visible="column.visible" :sortable="column.sortable && !isSortable" :width="column.width"> <div> <b-checkbox @click.native.stop v-if="index == 0":disabled="isReadonly" :native-value="props.row.product_id" v-model="checkedRows"></b-checkbox> <span v-if="column.field == \'status\'"><div class="tag has-tag-dot" :class="props.row.is_active?\'is-success\':\'is-danger\'">{{props.row.is_active?\'Активный\':\'Не активный\'|gettext}}</div></span> <span v-if="column.field == \'price\'"> <span v-if="props.row.price_compare" class="has-text-grey-light has-text-strike">{{ props.row.price_compare|currency(currency_title) }}</span> {{ props.row.price|currency(currency_title) }} </span> <span v-if="column.field == \'title\'"> <div class="has-text-danger is-pulled-right" v-if="!props.row.is_visible"><i class="fas fa-lock has-ml-1"></i></div> {{ props.row.title }} </span> <span v-if="column.field == \'weight\'"> {{ props.row.weight|weight(true) }}</span> <span v-if="column.field == \'tms_created\'"> {{ props.row.tms_created|datetime }} </span> <span v-if="column.field == \'collections\'"> <div class="tags" v-f="props.row.collections"> <span class="tag is-light" v-for="c in props.row.collections">{{ c }}</span> </div> </span> </div> </b-table-column> </template> <template slot="empty"> <section class="has-mb-4 has-mt-4 content has-text-grey has-text-centered" v-if="!isFetching"> <div v-if="isAllow && $refs.filterbox.hasFilter || filter.query"> <i class="fal fa-search fa-5x has-text-grey-light"></i> <h3>{{\'Ничего не найдено\'|gettext}}</h3> </div> <div v-else> <div class="row"> <div class="col-xs-12 col-sm-8 col-sm-offset-2 col-md-6 col-md-offset-3"> <div v-if="type == \'active\'"> <h3 class="has-p-2 has-text-grey-light has-text-centered has-mb-2"><i class="fal fa-boxes-alt has-text-grey-light" style="font-size: 5rem"></i></h3> <div class="has-mb-2">{{\'Список всех товаров, которые представлены в вашем магазине и доступны для заказа\'|gettext}}</div> <a @click="clickRow({product_id: null})" class="button is-primary" :class="{disabled: isReadonly}" v-if="isAllow"><i class=\'fas fa-plus\'></i><span class=\'has-ml-1\'>{{\'Новый товар\'|gettext}} </span></a> </div> <div v-else> <h3 class="has-p-2 has-text-grey-light has-text-centered has-mb-2"><i class="fal fa-archive has-text-grey-light" style="font-size: 5rem"></i></h3> <div class="has-mb-2">{{\'Снятые с продажи товары. Заказать товар из архива нельзя, но при необходимости любой товар из архива можно снова сделать активным\'|gettext}}</div> </div> </div> </div> <div class="has-text-centered" v-if="!isAllow"><div class="tag is-danger" style="top: -1px;position: relative;">biz</div> <span class=\'has-text-danger\'>{{\'Доступно на business-тарифе\'|gettext}}</span></div> </div> </section> <section class="has-mb-4 has-mt-4 content has-text-grey has-text-centered" v-if="isFetching"> <p>{{\'Загрузка данных\'|gettext}}</p> </section> </template> </b-table> </div> </div>'}),window.$app.defineComponent("products","vue-products-variants-form",{data:function(){return{isUpdating:!1,isFetching:!1,isReadonly:!1,query:"",values:{variant_title:"",variant_values:[]}}},created:function(){this.isReadonly=!this.$auth.isAllowEndpoint("products/variants/set"),this.variant_id&&this.fetchData(!0)},props:["variant_id"],mixins:[FormModel],computed:{isUsed:function(){return-1!=_.findIndex(this.values.variant_values,{is_used:!0})}},methods:{fetchData:function(t){var e=this;this.isFetching=t,this.$api.get("products/variants/get",{variant_id:this.variant_id}).then(function(t){e.isFetching=!1,e.values=t.response.variant.values})},updateData:function(){var e=this;this.isUpdating=!0,this.$api.post("products/variants/set",this.values,this).then(function(t){"success"==t.result&&e.$parent.close(),e.isUpdating=!1}).catch(function(t){e.isUpdating=!1})},deleteVariant:function(){var e=this;this.$confirm(this.$gettext("Вы уверены что хотите удалить этот вариант? Вы не сможете её вернуть!"),"is-danger").then(function(){e.$api.post("products/variants/delete",{variant_id:e.variant_id},e).then(function(t){"success"==t.result&&e.$parent.close()})})},onSelect:function(t){this.selected=t},onAddValue:function(){var i=this;(s=this.query.trim())&&_.each(s.split(","),function(t){if(t.length&&-1==_.findIndex(i.values.variant_values,{value:t})){var e=_.maxBy(i.values.variant_values,"key"),s=null==e?0:e.key+1;i.values.variant_values.push({key:s,value:t,is_busy:!1}),i.query="",i.errors.variant_values=""}})},onRemoveValue:function(t){this.values.variant_values.splice(t,1)}},template:'<div class="modal-card"> <header class="modal-card-head"> <p class="modal-card-title">{{\'Глобальное свойство товара\'|gettext}}</p> <button class="modal-close is-large" @click="$parent.close()"></button> </header> <section class="modal-card-body modal-card-body-blocks"> <section> <b-field :label="\'Название\'|gettext" :message="errors.variant_title" :class="{\'has-error\': errors.variant_title}"> <b-input v-model="values.variant_title" :placeholder="\'Укажите название свойства\'|gettext" :disabled="isReadonly"></b-input> </b-field> </section> <section> <div class="row row-small has-mb-2"> <div class="col-xs"> <b-field :message="errors.variant_values" :class="{\'has-error\': errors.variant_values}"> <input v-model="query" class="input" :placeholder="\'Укажите значение свойства\'|gettext" :disabled="isReadonly" @keydown.enter="onAddValue"></input> </b-field> </div> <div class="col-xs col-shrink"> <button type="button" class="button is-success" @click="onAddValue" :disabled="isReadonly">{{\'Добавить\'|gettext}}</button> </div> </div> <mx-item class="is-hidden-mobile mx-item-header" v-if="values.variant_values.length"> <div class="item-row row"> <div class="col-sm">{{\'Вариант\'|gettext}}</div> </div> </mx-item> <mx-item v-for="(v, i) in values.variant_values"> <div class="item-row row"> <div class="col-xs"><input type=\'text\' class=\'input variant-item\' v-model="v.value" :disabled="isReadonly"></div> <div class="col-xs col-shrink"><button type="button" class="button has-text-danger is-text" :class="{disabled: isReadonly || v.is_used}" @click="onRemoveValue(i)" :disabled="isReadonly || v.is_used"><i class="fa fa-trash-alt"></i></button></div> </div> </mx-item> </section> </section> <footer class="modal-card-foot level"> <div class="level-left"> <button class="button level-item" @click="deleteVariant" v-if="!isReadonly && variant_id && !isUsed"><i class="fa fa-trash-alt"></i> {{\'Удалить\'|gettext}}</button> </div> <div class="level-right"> <button class="button is-dark" type="button" @click="$parent.close()">{{\'Отмена\'|gettext}}</button> <button class="button is-primary" :class="{\'is-loading\': isUpdating, disabled: isReadonly}" @click="updateData">{{\'Сохранить\'|gettext}}</button> </div> </footer> <b-loading :is-full-page="false" :active.sync="isFetching"></b-loading> </div>'}),window.$app.defineComponent("products","vue-products-variants-list",{data:function(){return{isFetching:!1,isFiltering:!1,isReadonly:!1,filter:{query:""},sortField:"variant_title",sortOrder:"asc",perPage:20,columns:["variant_title","variant_values"],isAllow:this.$auth.isAllowTariff("business")}},mixins:[ListModel],created:function(){this.isReadonly=!this.$auth.isAllowEndpoint("products/variants/set"),this.$io.on("events:products.variants.list:refresh",this.refreshvariants),this.$io.on("events:products.variants.list:delete",this.deletevariant),this.fetchData(!0)},destroyed:function(){this.$io.off("events:products.variants.list:refresh",this.refreshvariants),this.$io.off("events:products.variants.list:delete",this.deletevariant)},computed:{columns_props:function(){if(!this.columns)return[];for(var s={variant_title:{label:"Название",sortable:!0,classname:"has-text-nowrap has-width-25"},variant_values:{label:"Варианты"}},t=_.map(this.columns,function(t){var e=s[t];return e.visible=!0,e.field=t,e}),e=0;e<11-this.columns.length;e++)t.push({visible:!1});return t}},methods:{refreshvariants:function(t){var s=this;null!=t.product_ids?this.merge(this.fields,"variant_id",t.variant_ids,function(t,e){s.$api.get("products/variants/list",{filter:{variant_ids:t}}).then(function(t){s.fields=e(t.response.variants.fields)})}):this.fetchData(!1,!0)},deletevariant:function(t){this.checkIds(this.fields,"variant_id",t.variant_ids).length&&this.fetchData(!1,!0)},fetchData:function(t,e){var s=this;!e&&this.checkCache()||(this.isFetching=t,this.$api.get("products/variants/list",{next:this.next,count:this.perPage,sort_field:this.sortField,sort_order:this.sortOrder,filter:this.filter}).then(function(t){s.cachePage(t.response.variants),s.isFetching=!1,s.isFiltering=!1}).catch(function(t){throw s.accesses=[],s.total=0,s.isFetching=!1,s.isFiltering=!1,t}))},onPageChange:function(t){this.page=t,this.fetchData(!0)},onFilter:function(){this.isFiltering=!0,this.clearPages(),this.fetchData(!0)},clickRow:function(t){console.log("click"),this.openForm(t.variant_id)},openForm:function(t){this.$form("vue-products-variants-form",{variant_id:t},this)}},template:'<div> <vue-component-filterbox ref="filterbox" v-if="isAllow" @filter="onFilter" v-model="filter" :is-visible="fields.length" :disabled="isFetching" :with-buttons="true"> <template slot="buttons"> <button class="button" @click="openForm(null)" class="button is-primary is-fullwidth" :class="{disabled: isReadonly}"><i class=\'fa fa-plus\'></i><span class=\'is-hidden-touch has-ml-1\'>{{\'Добавить свойство\'|gettext}}</span></button> </template> </vue-component-filterbox> <div class="container has-mb-3" :class="{\'has-mt-3\': !isAllow}"> <b-table paginated backend-pagination backend-sorting pagination-simple :data="fields" :loading="isFetching" :per-page="perPage" :total="total" :default-sort="[sortField, sortOrder]" @page-change="onPageChange" @click="clickRow" @sort="onSort" hoverable bordered> <template slot-scope="props"> <b-table-column v-for="(column, index) in columns_props" :field="column.field" :label="column.label|gettext" :class="column.classname" :numeric="column.numeric" :key="index" :visible="column.visible" :sortable="column.sortable" :width="column.width"> <div v-if="column.field == \'variant_title\'">{{ props.row.variant_title }}</div> <div v-if="column.field == \'variant_values\'"><div class="tags"> <span class="tag is-light" v-for="c in props.row.variant_values">{{ c }}</span> </div></div> </b-table-column> </template> <template slot="empty"> <section class="has-mb-4 has-mt-4 content has-text-grey has-text-centered" v-if="!isFetching"> <div v-if="isAllow && $refs.filterbox.hasFilter || filter.query"> <i class="fal fa-search fa-5x has-text-grey-light"></i> <h3>{{\'Ничего не найдено\'|gettext}}</h3> </div> <div v-else> <div class="row"> <div class="col-xs-12 col-sm-8 col-sm-offset-2 col-md-6 col-md-offset-3"> <h3 class="has-p-2 has-text-grey-light has-text-centered has-mb-2"><i class="fal fa-swatchbook has-text-grey-light" style="font-size: 5rem"></i></h3> <div class="has-mb-2">{{\'Глобальные свойства содержат наборы "вариантов", которые в один клик могут быть добавлены к любому товару магазина. Через глобальные свойства удобно размещать размерную сетку или иные параметры, выбор которых покупателем актуален более чем для одного товара вашего ассортимента.\'|gettext}}</div> <button class="button" @click="openForm(null)" class="button is-primary" :class="{disabled: isReadonly}" v-if="isAllow"><i class=\'fa fa-plus\'></i> {{\'Добавить свойство\'|gettext}}</button> <div class="has-text-centered" v-else><div class="tag is-danger" style="top: -1px;position: relative;">biz</div> <span class=\'has-text-danger\'>{{\'Доступно на business-тарифе\'|gettext}}</span></div> </div> </div> </div> </section> <section class="has-mb-4 has-mt-4 content has-text-grey has-text-centered" v-if="isFetching"> <p>{{\'Загрузка данных\'|gettext}}</p> </section> </template> </b-table> </div> </div>'}),window.$app.defineModule("products",[{path:"/:page_id/products/active/",component:"vue-products-list",meta:{title:"Активные"},props:{type:"active"},name:"products.active"},{path:"/:page_id/products/archive/",component:"vue-products-list",meta:{title:"Архив"},props:{type:"archive"},name:"products.archive"},{path:"/:page_id/products/collections/",component:"vue-products-collections-list",meta:{title:"Коллекции"},props:!0,name:"products.collections"},{path:"/:page_id/products/variants/",component:"vue-products-variants-list",meta:{title:"Свойства"},props:!0,name:"products.variants"},{path:"/:page_id/products/promocodes/",component:"vue-products-discounts-list",meta:{title:"Промокоды"},props:{type:"promocode"},name:"products.promocodes"},{path:"/:page_id/products/discounts/",component:"vue-products-discounts-list",meta:{title:"Акции"},props:{type:"automatic"},name:"products.discounts"}]);
