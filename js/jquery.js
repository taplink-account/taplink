function initVars(){$mx.touch={isXS:screen.width<768||$mx(window).width()<768,isSM:768<=screen.width&&screen.width<992,isApplication:$mx.isset(window.navigator.standalone)&&window.navigator.standalone,isDevice:!1,isTouch:"ontouchstart"in window,initScroll:function(){},isIOS:null!=navigator.userAgent.match(/iphone|ipod|ipad/gi)}}initVars(),$mx(window).on("resize",initVars);var scrollTop=0,isXS=screen.width<768||$mx(window).width()<768;!function(){"use strict";$mx.router={open:function(a,o,e,t,i,n){o=o||"module",e=e||"flat",t=t||"...",a=a.replace("layout-refresh=yes","").replace("?&","?"),$mx(document.body).addClass("disable-pointer-events");var s=document.location.href;"/"!=a.substring(0,1)&&(a=s.substring(0,"?"==a[0]?-1!=s.lastIndexOf("?")?s.lastIndexOf("?"):s.length:s.lastIndexOf("/")+1)+a);var l=null!=o&&"replace"==o,r=null,m=null,d=null,u=null;if("form"==o){var c=$mx('<div class="modal '+(isXS?"downup":"zoom")+'"><div class="modal-dialog modal-'+e+'"><div class="modal-content"><div class="waiting waiting-blue" style="min-height:200px"></div></div></div></div>').appendTo(document.body);m=c.find(".modal-content"),d=c.find(".modal-body");i=document.location.hash;c.modal({keyboard:!1,backdrop:"static"}),c.on("hidden.bs.modal",function(){isXS&&($mx(document.body).removeClass("lock-modal"),$mx(window).scrollTop(scrollTop)),$mx(document.body).trigger("modal.hide"),c.remove()}),$mx(document.body).trigger("modal.show"),i&&"string"!=typeof i&&(i=i.data("modal-hash")),isXS&&(scrollTop=$mx(window).scrollTop(),$mx(document.body).addClass("lock-modal"))}else if("fullscreen"==o||"fullscreen-iframe"==o){c=$mx('<div class="modal downup"><div class="modal-dialog modal-fullscreen"><div class="modal-content waiting waiting-blue"></div></div></div>').appendTo(document.body);m=d=c.find(".modal-content"),c.modal({keyboard:!1,backdrop:"static"}).on("hidden.bs.modal",function(){$mx(document.body).trigger("modal.hide"),c.remove()}),$mx(document.body).trigger("modal.show")}else"module"==o?(r=m=$mx($.app.body),d=$mx(".main-block-stack.active > div:first-child"),u=$mx("mx-header > ul li:last-child"),$mx($.app.body).removeClass("open-menu")):"ajax"!=o&&(r=l?$mx(".main-block-stack.active"):$mx('<div class="main-block-stack mx-scroll-content" data-scroll-y="true"><div></div></div>').appendTo(".main-block"),d=m=r.children(":first-child"),u=l?$mx("mx-header > ul li:last-child"):$.layout.breadcrumb.push(t,i),isXS&&!l&&(r.addClass("pre-out-in").prev().addClass("pre-in-out"),u.addClass("pre-out-in").prev().addClass("pre-in-out"),setTimeout(function(){r.addClass("in").prev().addClass("in"),u.addClass("in").prev().addClass("in")},0),r.addClass("active").prev().removeClass("active"),setTimeout(function(){r.removeClass("pre-out-in in").prev().removeClass("pre-in-out in active"),u.removeClass("pre-out-in in").prev().removeClass("pre-in-out in")},400)));var f=setTimeout(function(){isXS&&(t&&"..."!=t&&$mx("mx-header > ul li:last-child").removeClass("has-subtitle").html(t),d.addClass("waiting waiting-blue").html(""))},310),v=a;if("module"==o&&(v+=(-1==v.indexOf("?")?"?":"&")+"layout-module=yes"),"fullscreen-iframe"==o){m.html("");var p=$mx('<iframe frameborder="0"></iframe>').appendTo(m);p.attr("src",v),$mx(p).on("load",function(){m.removeClass("waiting"),$mx(document.body).removeClass("disable-pointer-events")})}else console.log(v),$mx.get(v).then(function(t){t=t.data,clearTimeout(f),"push"!=o&&"form"!=o&&"ajax"!=o&&(n?history.replaceState({},document.title,a):history.pushState({},document.title,a),$mx.isset($.layout)&&$.layout.setCurrentPath()),$mx(window).trigger("hit",{remote:a,title:document.title}),$mx.form.parseResult(t)||(isXS&&d.removeClass("waiting waiting-blue"),setTimeout(function(){if(m.html(""),m.html(t),m.find(":focus").focus(),m.toggleClass("mx-scroll-content-has-disabled",0<m.find(".mx-scroll-content-disable").length),"form"!=o){isXS||l||r.addClass("active").prev().removeClass("active"),m.find("form").each(function(){null==$mx(this).attr("action")&&$mx(this).attr("action",a)});var e=$mx("mx-breadcrumb",m).data("title");e=e||m.find(".modal-title").html(),u.text(e)}isXS?m.find("[autofocus]").removeAttr("autofocus"):m.find("[modal-autofocus]").focus()},0)),$mx(document.body).removeClass("disable-pointer-events")})}}}(document,window),function(d,w){"use strict";$mx.form={closeForm:function(e){var t=$mx.isset(e)&&e?e.closest(".modal"):null;t&&t.length&&t.modal("hide")},parseResult:function parseResult(s,form,target){if("ok"==s)return form&&form.trigger("close"),!0;if("ok"!=s.substring(0,2))return!1;s=s.split(":"),s.shift();for(var i=0;i<s.length;i++)switch(s[i]){case"update":i++;break;case"call":i++,eval(s[i]);break;case"close":form&&$mx(form).closest(".layout-panel-right").length?$.layout.panels.right.close():$mx.form.closeForm(form),form=null;break;case"go":$mx(document.body).removeClass("authscreen"),i++,go(s[i],!1,!0);break;case"gohard":i++,go(s[i],!0);break;case"modal":i++;var ms=s[i].split("@");$mx.router.open(ms[0],"push",null==ms[1]?"":ms[1],null==ms[2]?null:ms[2],null==ms[3]?null:ms[3]);break;case"modalform":i++;var ms=s[i].split("@");$mx.router.open(ms[0],"form",null==ms[1]?"":ms[1],null==ms[2]?null:ms[2],null==ms[3]?null:ms[3]);break;case"fullscreen":case"fullscreen-iframe":i++;var ms=s[i].split("@");$mx.router.open(ms[0],s[i-1],null==ms[1]?"":ms[1],null==ms[2]?null:ms[2],null==ms[3]?null:ms[3]);break;case"remove":i++,$mx(s[i]).remove()}return!0},updateForm:function(e,t,o,a,i,n,s){$mx.isset(e.preventDefault)&&e.preventDefault();var l=$mx(null==e.target||null!=e.tagName?e:e.target),r=l.is("form")?l:l.closest("form");s=null==s?[]:s;null!=t&&""!=t&&(s.action=t),r.trigger("beforeSubmit"),r.addClass("mx-form-updating"),$mx(document.body).trigger("keyboardclose"),$mx.isset(i)||(i=!0);var m=$mx(document.activeElement),d=m.attr("name"),u=m.is("textarea,input[type=text],input[type=tel]")?m.caret():null;l.is("button")&&(l.find(".updating-block").length||$mx('<div class="updating-block"></div>').appendTo(l),l.is(".ignore-updating-link")||l.addClass("is-loading"));var c=[];return r.find("input,textarea,button[name]").each(function(e){c[e.name]=e.value}),$mx.request({url:r.attr("action"),data:c,method:null==a?"post":a}).then(function(e){if(e=e.data,r.find('button[type="submit"]').removeClass("is-loading"),l.is("button")&&l.removeClass("is-loading"),r.removeClass("mx-form-updating"),$mx(document.body).removeClass("grayscale-sm disable-pointer-events"),!$mx.form.parseResult(e,r,o)){var t=null==o?r.parent():$mx(o);"opacity"==r.data("modal-animation")?t.animate({opacity:0},"fast",function(){t.html(e),t.animate({opacity:1},"fast")}):t.html(e),r=t.find("form"),d&&setTimeout(function(){var e=$mx("[name='"+d+"']");e.focus(),u&&e.caret(u.begin,u.end)},0),null!=n&&n(),r.data("updating",!1),t.find('[data-dismiss="modal"]').click(function(){$mx.form.closeForm(t.find("form"))});var a=t.find('script[type="form/result"]');a.length&&$mx.form.parseResult("ok:"+a.text(),r,o)}}),!1}},$mx.observe("form[data-target='modal']",function(o){function i(e,t,a){return $mx.form.updateForm(e,t,o.data("selection"),void 0,void 0,void 0,a)}o.removeAttr("data-validator"),o.data("observe")||o.data("enter-ignore")||$mx("input",o).keypress(function(e){if(13==e.keyCode)return i(this,(e=$mx(this)).hasAttr("data-observe")?e.data("observe"):"submit")}),o.data("enter-ignore")&&$mx("input",o).keypress(function(e){13==e.keyCode&&e.preventDefault()}),o.data("observe-changed")&&$mx("input,textarea",o).change(function(){if(!$mx(this).data("observe-ignore"))return i(this,"submit")}),o.data("observe")?(o.observe(function(){i(o,null)}),o.on("submit",function(){return!1}),o.on("observe",function(){return i(this,"submit")})):o.on("submit",function(){return i(this,"submit")}),o.delegate("[data-submit-action]","keydown",function(e){if(13==e.which)return e.preventDefault(),i(this,$mx(this).data("submit-action"))}),o.delegate('button[type=submit], button[data-type="submit"]',"click",function(){var e=$mx(this),t=e.attr("name"),a={},o="submit";return $mx.isset(t)&&("action"==t?o=e.attr("value"):a[t]=e.attr("value")),!(e.data("modal-confirm")&&!confirm(e.data("modal-confirm")))&&i(this,o,a)}),o.delegate("[data-observe]","change",function(){var e=this;setTimeout(function(){i(e,$mx(e).data("observe"))},0)})})}(document,window),$mx(function(){$mx(document.body).on("click","a[data-modal], .mx-link .item-row > div:not(.mx-not-link)",function(e){var t=$mx(this);if(t.closest(".mx-link").length&&(t=t.closest(".mx-link")),t.is(":disabled")||t.is(".disabled")||t.attr("disabled"))return e.stopPropagation(),void e.preventDefault();var a=t.data(),o=a.remote?a.remote:t.attr("href");return 0==o.indexOf("javascript:")||"#"==o.substring(0,1)||(this.target||null!=e&&e.metaKey?($mx(".modal-backdrop-header-panel").click(),!0):(a.modalConfirm&&!confirm(a.modalConfirm)?(e.stopPropagation(),e.preventDefault()):$mx.router.open(o,a.modal,void 0,void 0,t),!1))})});
